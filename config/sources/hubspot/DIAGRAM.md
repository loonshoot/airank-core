# hubspot Batch Job Process Flow

```
┌─────────────────────┐
│                     │
│    Start Batch      │
│       Job           │
│                     │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐     ┌─────────────────────┐
│     Step 1:         │     │                     │
│  Discover Custom    │────▶│   Custom Objects    │
│     Objects         │     │      List           │
│                     │     │                     │
└──────────┬──────────┘     └─────────────────────┘
           │
           ▼
┌─────────────────────┐     ┌─────────────────────┐
│     Step 2:         │     │                     │
│  Create Object      │────▶│   Object Download   │
│  Download List      │     │       List          │
│                     │     │                     │
└──────────┬──────────┘     └─────────────────────┘
           │
           ▼
┌─────────────────────┐                 ┌─────────────────────┐
│     Step 3:         │                 │                     │
│  Download Object    │─────Stream─────▶│   MongoDB Stream    │
│     Records         │                 │    Collection       │
│                     │                 │                     │
└──────────┬──────────┘                 └─────────────────────┘
           │                              ▲
           ▼                              │
┌─────────────────────┐                  │
│     Step 4:         │                  │
│  Discover Event     │                  │
│      Types          │                  │
│                     │                  │
└──────────┬──────────┘                  │
           │                             │
           ▼                             │
┌─────────────────────┐                  │
│     Step 5:         │                  │
│  Download Events    │─────Stream───────┘
│  For Each Type      │                  
│                     │                  
└──────────┬──────────┘                  
           │                             
           ▼                             
┌─────────────────────┐                  
│     Step 6:         │                  
│  Fetch & Process    │─────Stream───────┘
│  Relationships      │                  
│                     │                  
└──────────┬──────────┘                  
           │
           ▼
┌─────────────────────┐
│                     │
│  Update Job History │
│                     │
│                     │
└─────────────────────┘
```

## hubspot Data Types Flow

```
┌─────────────────┐    ┌────────────────────┐    ┌────────────────────┐
│                 │    │                    │    │                    │
│  Standard       │───▶│                    │    │                    │
│  Objects        │    │                    │    │                    │
│                 │    │                    │    │                    │
└─────────────────┘    │                    │    │                    │
                       │    Stream          │    │    Consolidation   │
┌─────────────────┐    │    Collection      │───▶│    Jobs            │
│                 │    │                    │    │                    │
│  Custom         │───▶│    (source_{id}_   │    │                    │
│  Objects        │    │     stream)        │    │                    │
│                 │    │                    │    │                    │
└─────────────────┘    │                    │    │                    │
                       │                    │    │                    │
┌─────────────────┐    │                    │    │                    │
│                 │    │                    │    │                    │
│  Events         │───▶│                    │    │                    │
│                 │    │                    │    │                    │
└─────────────────┘    └────────────────────┘    └────────────────────┘

┌─────────────────┐    
│                 │    
│  Relationships  │────┐
│                 │    │
└─────────────────┘    │
                       ▼
                    ┌────────────────────┐
                    │                    │
                    │  Relationship      │
                    │  Consolidation     │
                    │                    │
                    └────────────────────┘
```

## Rate Limiting Mechanism

```
┌─────────────────┐    ┌────────────────────┐    ┌────────────────────┐
│                 │    │                    │    │                    │
│  API            │───▶│  Rate Limiter      │───▶│  API               │
│  Request        │    │  Check             │    │  Call              │
│                 │    │                    │    │                    │
└─────────────────┘    └────────────────────┘    └────────────────────┘
                              │                           │
                              │                           │
                              ▼                           ▼
                       ┌────────────────┐        ┌────────────────────┐
                       │                │        │                    │
                       │ Limit Reached  │        │  Process           │
                       │ Wait & Retry   │        │  Response          │
                       │                │        │                    │
                       └────────────────┘        └────────────────────┘
```

## Relationship Processing

```
┌───────────────┐        ┌────────────────────┐       ┌────────────────────┐
│               │        │                    │       │                    │
│  HubSpot      │───────▶│  v4 Associations   │──────▶│  Process           │
│  Entity       │        │  API               │       │  Associations      │
│               │        │                    │       │                    │
└───────────────┘        └────────────────────┘       └────────────────────┘
                                                               │
                                                               │
                                                               ▼
 ┌────────────────────┐                             ┌────────────────────┐
 │                    │                             │                    │
 │  Stream            │◀────────────────────────────│  Create            │
 │  Collection        │                             │  Relationship      │
 │                    │                             │  Records           │
 └────────────────────┘                             └────────────────────┘
```

## Error Handling Flow

```
┌───────────────┐      ┌────────────────────┐     ┌───────────────────┐     ┌───────────────────┐
│               │      │                    │     │                   │     │                   │
│  API Call     │─────▶│  Error            │────▶│  Log Error        │────▶│  Continue         │
│  Attempt      │      │  Occurs           │     │  Details          │     │  Processing       │
│               │      │                    │     │                   │     │                   │
└───────────────┘      └────────────────────┘     └───────────────────┘     └───────────────────┘
                                │
                                │
                                ▼
                       ┌────────────────────┐
                       │                    │
                       │  Update Job        │
                       │  History           │
                       │                    │
                       └────────────────────┘
``` 